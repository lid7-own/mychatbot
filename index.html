import React, { useState, useEffect, useRef } from 'react';
import { Send, Settings, Trash2, Moon, Sun, Palette, Globe, MessageSquare } from 'lucide-react';

const CreationAI = () => {
  const [messages, setMessages] = useState([]);
  const [input, setInput] = useState('');
  const [loading, setLoading] = useState(false);
  const [showSettings, setShowSettings] = useState(false);
  const [apiKey, setApiKey] = useState('');
  const [language, setLanguage] = useState('en');
  const [isDark, setIsDark] = useState(true);
  const [currentTheme, setCurrentTheme] = useState(0);
  const [welcomeMsg, setWelcomeMsg] = useState('');
  const messagesEndRef = useRef(null);

  const themes = [
    { name: 'Purple Dream', primary: '#8B5CF6', secondary: '#A78BFA', bg: '#1F1B2E' },
    { name: 'Ocean Blue', primary: '#3B82F6', secondary: '#60A5FA', bg: '#1E293B' },
    { name: 'Emerald', primary: '#10B981', secondary: '#34D399', bg: '#1F2937' },
    { name: 'Rose', primary: '#F43F5E', secondary: '#FB7185', bg: '#2D1B2E' },
    { name: 'Amber', primary: '#F59E0B', secondary: '#FBBF24', bg: '#2E2419' },
    { name: 'Cyan', primary: '#06B6D4', secondary: '#22D3EE', bg: '#1A2E2E' },
    { name: 'Pink Sunset', primary: '#EC4899', secondary: '#F472B6', bg: '#2E1B2A' },
    { name: 'Lime', primary: '#84CC16', secondary: '#A3E635', bg: '#232E1B' },
    { name: 'Indigo', primary: '#6366F1', secondary: '#818CF8', bg: '#1E1B2E' },
    { name: 'Orange', primary: '#F97316', secondary: '#FB923C', bg: '#2E1F1B' },
    { name: 'Teal', primary: '#14B8A6', secondary: '#2DD4BF', bg: '#1B2E2A' },
    { name: 'Red Fire', primary: '#EF4444', secondary: '#F87171', bg: '#2E1B1B' },
    { name: 'Yellow Sun', primary: '#EAB308', secondary: '#FACC15', bg: '#2E2A1B' },
    { name: 'Violet', primary: '#7C3AED', secondary: '#A78BFA', bg: '#231B2E' },
    { name: 'Sky', primary: '#0EA5E9', secondary: '#38BDF8', bg: '#1B252E' }
  ];

  const translations = {
    en: {
      title: 'Creation AI',
      subtitle: 'Your Creative & Innovative Assistant',
      placeholder: 'Share your creative ideas...',
      send: 'Send',
      settings: 'Settings',
      clearChat: 'Clear Chat',
      apiKeyLabel: 'Gemini API Key',
      apiKeyPlaceholder: 'Enter your API key',
      themeLabel: 'Choose Theme',
      languageLabel: 'Language',
      welcomeLabel: 'Welcome Message',
      welcomePlaceholder: 'Customize your greeting...',
      defaultWelcome: 'Hello! I\'m Creation AI, your creative companion. Let\'s explore ideas, solve problems, and think outside the box together! üöÄ‚ú®',
      darkMode: 'Dark Mode',
      lightMode: 'Light Mode',
      save: 'Save Settings'
    },
    id: {
      title: 'Creation AI',
      subtitle: 'Asisten Kreatif & Inovatif Anda',
      placeholder: 'Bagikan ide kreatif Anda...',
      send: 'Kirim',
      settings: 'Pengaturan',
      clearChat: 'Hapus Chat',
      apiKeyLabel: 'Gemini API Key',
      apiKeyPlaceholder: 'Masukkan API key Anda',
      themeLabel: 'Pilih Tema',
      languageLabel: 'Bahasa',
      welcomeLabel: 'Pesan Sambutan',
      welcomePlaceholder: 'Sesuaikan sambutan Anda...',
      defaultWelcome: 'Halo! Saya Creation AI, teman kreatif Anda. Mari jelajahi ide, pecahkan masalah, dan berpikir di luar kotak bersama! üöÄ‚ú®',
      darkMode: 'Mode Gelap',
      lightMode: 'Mode Terang',
      save: 'Simpan Pengaturan'
    },
    fr: {
      title: 'Creation AI',
      subtitle: 'Votre Assistant Cr√©atif et Innovant',
      placeholder: 'Partagez vos id√©es cr√©atives...',
      send: 'Envoyer',
      settings: 'Param√®tres',
      clearChat: 'Effacer le Chat',
      apiKeyLabel: 'Cl√© API Gemini',
      apiKeyPlaceholder: 'Entrez votre cl√© API',
      themeLabel: 'Choisir le Th√®me',
      languageLabel: 'Langue',
      welcomeLabel: 'Message de Bienvenue',
      welcomePlaceholder: 'Personnalisez votre message...',
      defaultWelcome: 'Bonjour! Je suis Creation AI, votre compagnon cr√©atif. Explorons des id√©es, r√©solvons des probl√®mes et pensons diff√©remment ensemble! üöÄ‚ú®',
      darkMode: 'Mode Sombre',
      lightMode: 'Mode Clair',
      save: 'Enregistrer'
    },
    zh: {
      title: 'Creation AI',
      subtitle: 'ÊÇ®ÁöÑÂàõÊÑè‰∏éÂàõÊñ∞Âä©Êâã',
      placeholder: 'ÂàÜ‰∫´ÊÇ®ÁöÑÂàõÊÑèÊÉ≥Ê≥ï...',
      send: 'ÂèëÈÄÅ',
      settings: 'ËÆæÁΩÆ',
      clearChat: 'Ê∏ÖÈô§ËÅäÂ§©',
      apiKeyLabel: 'Gemini APIÂØÜÈí•',
      apiKeyPlaceholder: 'ËæìÂÖ•ÊÇ®ÁöÑAPIÂØÜÈí•',
      themeLabel: 'ÈÄâÊã©‰∏ªÈ¢ò',
      languageLabel: 'ËØ≠Ë®Ä',
      welcomeLabel: 'Ê¨¢Ëøé‰ø°ÊÅØ',
      welcomePlaceholder: 'Ëá™ÂÆö‰πâÊÇ®ÁöÑÈóÆÂÄôËØ≠...',
      defaultWelcome: '‰Ω†Â•ΩÔºÅÊàëÊòØCreation AIÔºå‰Ω†ÁöÑÂàõÊÑè‰ºô‰º¥„ÄÇËÆ©Êàë‰ª¨‰∏ÄËµ∑Êé¢Á¥¢ÊÉ≥Ê≥ï„ÄÅËß£ÂÜ≥ÈóÆÈ¢ò„ÄÅË∑≥Âá∫ÊÄùÁª¥ÂÆöÂºèÔºÅüöÄ‚ú®',
      darkMode: 'ÊöóËâ≤Ê®°Âºè',
      lightMode: '‰∫ÆËâ≤Ê®°Âºè',
      save: '‰øùÂ≠òËÆæÁΩÆ'
    },
    ja: {
      title: 'Creation AI',
      subtitle: '„ÅÇ„Å™„Åü„ÅÆ„ÇØ„É™„Ç®„Ç§„ÉÜ„Ç£„ÉñÔºÜ„Ç§„Éé„Éô„Éº„ÉÜ„Ç£„Éñ„Ç¢„Ç∑„Çπ„Çø„É≥„Éà',
      placeholder: '„ÇØ„É™„Ç®„Ç§„ÉÜ„Ç£„Éñ„Å™„Ç¢„Ç§„Éá„Ç¢„ÇíÂÖ±Êúâ...',
      send: 'ÈÄÅ‰ø°',
      settings: 'Ë®≠ÂÆö',
      clearChat: '„ÉÅ„É£„ÉÉ„Éà„Çí„ÇØ„É™„Ç¢',
      apiKeyLabel: 'Gemini API„Ç≠„Éº',
      apiKeyPlaceholder: 'API„Ç≠„Éº„ÇíÂÖ•Âäõ',
      themeLabel: '„ÉÜ„Éº„Éû„ÇíÈÅ∏Êäû',
      languageLabel: 'Ë®ÄË™û',
      welcomeLabel: '„Ç¶„Çß„É´„Ç´„É†„É°„ÉÉ„Çª„Éº„Ç∏',
      welcomePlaceholder: 'Êå®Êã∂„Çí„Ç´„Çπ„Çø„Éû„Ç§„Ç∫...',
      defaultWelcome: '„Åì„Çì„Å´„Å°„ÅØÔºÅÁßÅ„ÅØCreation AI„ÄÅ„ÅÇ„Å™„Åü„ÅÆ„ÇØ„É™„Ç®„Ç§„ÉÜ„Ç£„Éñ„Å™‰ª≤Èñì„Åß„Åô„ÄÇ‰∏ÄÁ∑í„Å´„Ç¢„Ç§„Éá„Ç¢„ÇíÊé¢Ê±Ç„Åó„ÄÅÂïèÈ°å„ÇíËß£Ê±∫„Åó„ÄÅÊû†„ÇíË∂Ö„Åà„Å¶ËÄÉ„Åà„Åæ„Åó„Çá„ÅÜÔºÅüöÄ‚ú®',
      darkMode: '„ÉÄ„Éº„ÇØ„É¢„Éº„Éâ',
      lightMode: '„É©„Ç§„Éà„É¢„Éº„Éâ',
      save: 'Ë®≠ÂÆö„Çí‰øùÂ≠ò'
    }
  };

  const t = translations[language];
  const theme = themes[currentTheme];

  useEffect(() => {
    const saved = localStorage.getItem('creationAI');
    if (saved) {
      const data = JSON.parse(saved);
      setMessages(data.messages || []);
      setApiKey(data.apiKey || '');
      setLanguage(data.language || 'en');
      setCurrentTheme(data.theme || 0);
      setIsDark(data.isDark !== undefined ? data.isDark : true);
      setWelcomeMsg(data.welcomeMsg || '');
    }
  }, []);

  useEffect(() => {
    localStorage.setItem('creationAI', JSON.stringify({
      messages,
      apiKey,
      language,
      theme: currentTheme,
      isDark,
      welcomeMsg
    }));
  }, [messages, apiKey, language, currentTheme, isDark, welcomeMsg]);

  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages]);

  const sendMessage = async () => {
    if (!input.trim() || !apiKey) return;

    const userMsg = { role: 'user', content: input };
    setMessages(prev => [...prev, userMsg]);
    setInput('');
    setLoading(true);

    try {
      const systemPrompt = `You are Creation AI, a creative and innovative AI assistant. Your personality:
- Inspirational and supportive
- Encourages out-of-the-box thinking
- Helps with brainstorming, creative writing, problem-solving
- Responds with enthusiasm and positivity
- Uses emojis appropriately to enhance engagement
- Provides actionable creative insights

Always respond in ${language === 'en' ? 'English' : language === 'id' ? 'Indonesian' : language === 'fr' ? 'French' : language === 'zh' ? 'Chinese' : 'Japanese'}.`;

      const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=' + apiKey, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{
            parts: [
              { text: systemPrompt },
              { text: input }
            ]
          }]
        })
      });

      const data = await response.json();
      const aiMsg = {
        role: 'assistant',
        content: data.candidates?.[0]?.content?.parts?.[0]?.text || 'Error generating response'
      };
      setMessages(prev => [...prev, aiMsg]);
    } catch (error) {
      setMessages(prev => [...prev, { role: 'assistant', content: 'Error: ' + error.message }]);
    }
    setLoading(false);
  };

  const clearChat = () => {
    setMessages([]);
  };

  const bgColor = isDark ? theme.bg : '#F8F9FA';
  const textColor = isDark ? '#FFFFFF' : '#1F2937';
  const cardBg = isDark ? 'rgba(255,255,255,0.05)' : 'rgba(0,0,0,0.03)';

  return (
    <div style={{
      minHeight: '100vh',
      background: `linear-gradient(135deg, ${theme.primary}15 0%, ${theme.secondary}15 100%)`,
      backgroundColor: bgColor,
      color: textColor,
      fontFamily: 'system-ui, -apple-system, sans-serif',
      transition: 'all 0.3s ease'
    }}>
      {/* Header */}
      <div style={{
        background: `linear-gradient(135deg, ${theme.primary} 0%, ${theme.secondary} 100%)`,
        padding: '20px',
        boxShadow: '0 4px 20px rgba(0,0,0,0.1)'
      }}>
        <div style={{ maxWidth: '1200px', margin: '0 auto', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
          <div>
            <h1 style={{ margin: 0, fontSize: '28px', fontWeight: 'bold', color: 'white' }}>
              ‚ú® {t.title}
            </h1>
            <p style={{ margin: '5px 0 0', fontSize: '14px', color: 'rgba(255,255,255,0.9)' }}>
              {t.subtitle}
            </p>
          </div>
          <div style={{ display: 'flex', gap: '10px' }}>
            <button onClick={() => setIsDark(!isDark)} style={{
              background: 'rgba(255,255,255,0.2)',
              border: 'none',
              borderRadius: '8px',
              padding: '10px',
              cursor: 'pointer',
              color: 'white'
            }}>
              {isDark ? <Sun size={20} /> : <Moon size={20} />}
            </button>
            <button onClick={() => setShowSettings(!showSettings)} style={{
              background: 'rgba(255,255,255,0.2)',
              border: 'none',
              borderRadius: '8px',
              padding: '10px',
              cursor: 'pointer',
              color: 'white'
            }}>
              <Settings size={20} />
            </button>
          </div>
        </div>
      </div>

      <div style={{ maxWidth: '1200px', margin: '0 auto', padding: '20px' }}>
        {/* Settings Panel */}
        {showSettings && (
          <div style={{
            background: cardBg,
            backdropFilter: 'blur(10px)',
            borderRadius: '16px',
            padding: '20px',
            marginBottom: '20px',
            border: `1px solid ${theme.primary}30`
          }}>
            <h3 style={{ marginTop: 0, color: theme.primary }}>‚öôÔ∏è {t.settings}</h3>
            
            <div style={{ marginBottom: '15px' }}>
              <label style={{ display: 'block', marginBottom: '5px', fontSize: '14px' }}>
                <Globe size={16} style={{ verticalAlign: 'middle', marginRight: '5px' }} />
                {t.languageLabel}
              </label>
              <select value={language} onChange={(e) => setLanguage(e.target.value)} style={{
                width: '100%',
                padding: '10px',
                borderRadius: '8px',
                border: `1px solid ${theme.primary}50`,
                background: isDark ? 'rgba(0,0,0,0.3)' : 'white',
                color: textColor
              }}>
                <option value="en">English</option>
                <option value="id">Bahasa Indonesia</option>
                <option value="fr">Fran√ßais</option>
                <option value="zh">‰∏≠Êñá</option>
                <option value="ja">Êó•Êú¨Ë™û</option>
              </select>
            </div>

            <div style={{ marginBottom: '15px' }}>
              <label style={{ display: 'block', marginBottom: '5px', fontSize: '14px' }}>
                <Palette size={16} style={{ verticalAlign: 'middle', marginRight: '5px' }} />
                {t.themeLabel}
              </label>
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(5, 1fr)', gap: '8px' }}>
                {themes.map((th, i) => (
                  <button key={i} onClick={() => setCurrentTheme(i)} style={{
                    padding: '8px',
                    borderRadius: '8px',
                    border: currentTheme === i ? `2px solid ${theme.primary}` : '1px solid transparent',
                    background: `linear-gradient(135deg, ${th.primary} 0%, ${th.secondary} 100%)`,
                    cursor: 'pointer',
                    fontSize: '10px',
                    color: 'white',
                    fontWeight: currentTheme === i ? 'bold' : 'normal'
                  }}>
                    {th.name}
                  </button>
                ))}
              </div>
            </div>

            <div style={{ marginBottom: '15px' }}>
              <label style={{ display: 'block', marginBottom: '5px', fontSize: '14px' }}>
                üîë {t.apiKeyLabel}
              </label>
              <input
                type="password"
                value={apiKey}
                onChange={(e) => setApiKey(e.target.value)}
                placeholder={t.apiKeyPlaceholder}
                style={{
                  width: '100%',
                  padding: '10px',
                  borderRadius: '8px',
                  border: `1px solid ${theme.primary}50`,
                  background: isDark ? 'rgba(0,0,0,0.3)' : 'white',
                  color: textColor
                }}
              />
            </div>

            <div style={{ marginBottom: '15px' }}>
              <label style={{ display: 'block', marginBottom: '5px', fontSize: '14px' }}>
                <MessageSquare size={16} style={{ verticalAlign: 'middle', marginRight: '5px' }} />
                {t.welcomeLabel}
              </label>
              <textarea
                value={welcomeMsg}
                onChange={(e) => setWelcomeMsg(e.target.value)}
                placeholder={t.welcomePlaceholder}
                style={{
                  width: '100%',
                  padding: '10px',
                  borderRadius: '8px',
                  border: `1px solid ${theme.primary}50`,
                  background: isDark ? 'rgba(0,0,0,0.3)' : 'white',
                  color: textColor,
                  minHeight: '80px',
                  resize: 'vertical'
                }}
              />
            </div>

            <button onClick={clearChat} style={{
              background: '#EF4444',
              color: 'white',
              border: 'none',
              padding: '10px 20px',
              borderRadius: '8px',
              cursor: 'pointer',
              display: 'flex',
              alignItems: 'center',
              gap: '8px'
            }}>
              <Trash2 size={16} /> {t.clearChat}
            </button>
          </div>
        )}

        {/* Chat Area */}
        <div style={{
          background: cardBg,
          backdropFilter: 'blur(10px)',
          borderRadius: '16px',
          padding: '20px',
          minHeight: '500px',
          maxHeight: '600px',
          overflowY: 'auto',
          border: `1px solid ${theme.primary}30`
        }}>
          {messages.length === 0 && (
            <div style={{ textAlign: 'center', padding: '40px', color: theme.primary }}>
              <h2 style={{ fontSize: '24px', marginBottom: '10px' }}>üé® {t.title}</h2>
              <p style={{ opacity: 0.8 }}>{welcomeMsg || t.defaultWelcome}</p>
            </div>
          )}

          {messages.map((msg, i) => (
            <div key={i} style={{
              marginBottom: '15px',
              display: 'flex',
              justifyContent: msg.role === 'user' ? 'flex-end' : 'flex-start'
            }}>
              <div style={{
                maxWidth: '75%',
                padding: '12px 16px',
                borderRadius: '16px',
                background: msg.role === 'user' 
                  ? `linear-gradient(135deg, ${theme.primary} 0%, ${theme.secondary} 100%)`
                  : isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.05)',
                color: msg.role === 'user' ? 'white' : textColor
              }}>
                {msg.content}
              </div>
            </div>
          ))}
          
          {loading && (
            <div style={{ display: 'flex', gap: '5px', padding: '10px' }}>
              <div style={{ width: '8px', height: '8px', borderRadius: '50%', background: theme.primary, animation: 'bounce 1s infinite' }}></div>
              <div style={{ width: '8px', height: '8px', borderRadius: '50%', background: theme.secondary, animation: 'bounce 1s infinite 0.2s' }}></div>
              <div style={{ width: '8px', height: '8px', borderRadius: '50%', background: theme.primary, animation: 'bounce 1s infinite 0.4s' }}></div>
            </div>
          )}
          <div ref={messagesEndRef} />
        </div>

        {/* Input Area */}
        <div style={{
          marginTop: '20px',
          display: 'flex',
          gap: '10px'
        }}>
          <input
            value={input}
            onChange={(e) => setInput(e.target.value)}
            onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
            placeholder={t.placeholder}
            style={{
              flex: 1,
              padding: '15px',
              borderRadius: '12px',
              border: `1px solid ${theme.primary}50`,
              background: cardBg,
              backdropFilter: 'blur(10px)',
              color: textColor,
              fontSize: '16px'
            }}
          />
          <button onClick={sendMessage} disabled={loading || !apiKey} style={{
            background: `linear-gradient(135deg, ${theme.primary} 0%, ${theme.secondary} 100%)`,
            color: 'white',
            border: 'none',
            padding: '15px 30px',
            borderRadius: '12px',
            cursor: loading || !apiKey ? 'not-allowed' : 'pointer',
            display: 'flex',
            alignItems: 'center',
            gap: '8px',
            fontWeight: 'bold',
            opacity: loading || !apiKey ? 0.5 : 1
          }}>
            <Send size={20} /> {t.send}
          </button>
        </div>
      </div>

      <style>{`
        @keyframes bounce {
          0%, 100% { transform: translateY(0); }
          50% { transform: translateY(-10px); }
        }
      `}</style>
    </div>
  );
};

export default CreationAI;
